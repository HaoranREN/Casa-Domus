<html>
<header>
  <title>Welcome to Casa Domus</title>
</header>

<body>
  <h2>Welcome to Casa Domus</h2>

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  <script src="http://127.0.0.1/~MarbleCake/papaparse.js" type="text/javascript"></script>
  <script src="http://127.0.0.1/~MarbleCake/searchCounty.js" type="text/javascript"></script>
  <script src="http://127.0.0.1/~MarbleCake/resources/data.js" type="text/javascript"></script>
  <script src="http://127.0.0.1/~MarbleCake/sortCounty.js" type="text/javascript"></script>

  <!- Angularjs View ->
  <div ng-app="mainApp" ng-controller="surveyController">

    <!- Input ->
    <table border="0">
      <tr>
        <td>Lets ask some questions first.</td>
      </tr>

      <tr></tr>

      <tr>
        <td>What is your current median household income?</td>
        <td>
          <input type="range" min="20000" max="200000" value="110000" class="slider" ng-model="userIncome">{{userIncome | currency}}
        </td>
      </tr>

      <tr>
        <td>How much property value can you afford?</td>
        <td>
          <input type="range" min="19800" max="1000000" value="509900" class="slider" ng-model="userProperty">{{userProperty | currency}}
        </td>
      </tr>

      <tr>
        <td>How far do you want you dollar to go? (Cost of living index)</td>
        <td>
          <input type="range" min="88" max="188" value="136.5" class="slider" ng-model="userLiving">{{userLiving}}
        </td>
      </tr>

      <tr>
        <td>How much can you afford to spend on rent a month?</td>
        <td>
          <input type="range" min="400" max="3000" value="1700" class="slider" ng-model="userRent">{{userRent | currency}}
        </td>
      </tr>

      <tr>
        <td>
          <button ng-click="execute()">Submit</button>
        </td>
      </tr>

    </table>

    <!- Crudely print the top 10 closest counties ->
    {{resultString}}
  </div>

  <script>
    var userResults = [];

    // Makes all json county data available
    parseCountyData();

    // Angularjs Controller
    var mainApp = angular.module("mainApp", []);

    mainApp.controller('surveyController', function ($scope) {
      // String with Output
      $scope.resultString = "";

      // User values (default values)
      $scope.userIncome = 110000;
      $scope.userProperty = 509900;
      $scope.userLiving = 136.5;
      $scope.userRent = 1700;

      $scope.execute = function () {
        // call get results HERE
        userResults = calculateDistance($scope.userIncome, $scope.userProperty, $scope.userLiving, $scope.userRent);
        console.log(userResults);
        this.printResults();
      }

      $scope.export = function () {
        var csv = Papa.unparse(userResults);
        console.log(csv);
      }

      $scope.printResults = function () {
        // the most barbaric way to print the results
        $scope.resultString = "";
        $scope.resultString += "Here are some Suggestions: ";
        $scope.resultString += userResults[0].areaName + " ";
        $scope.resultString += userResults[1].areaName + " ";
        $scope.resultString += userResults[2].areaName + " ";
        $scope.resultString += userResults[3].areaName + " ";
        $scope.resultString += userResults[4].areaName + " ";
        $scope.resultString += userResults[5].areaName + " ";
        $scope.resultString += userResults[6].areaName + " ";
        $scope.resultString += userResults[7].areaName + " ";
        $scope.resultString += userResults[8].areaName + " ";
        $scope.resultString += userResults[9].areaName + " ";
      }
    });
  </script>

</body>

</html>
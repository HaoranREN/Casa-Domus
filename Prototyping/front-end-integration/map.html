<html>
  <header>
    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <script type="text/javascript" src="https://maps.google.com/maps/api/js?v=3&key=AIzaSyB0vnW0Sd48sd0msALTLt3vGWIMwnwLBG4"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

  <script src="papaparse.js" type="text/javascript"></script>
  <script src="searchCounty.js" type="text/javascript"></script>
  <script src="data.js" type="text/javascript"></script>
  <script src="sortCounty.js" type="text/javascript"></script>
  <script src="map_api.js" type="text/javascript"></script>
  <script src="script.js" type="text/javascript"></script>

 <link rel="stylesheet" href="map.css">
  <style>
  /* Paste this css to your style sheet file or under head tag */
  /* This only works with JavaScript, 
  if it's not present, don't show loader */
.no-js #loader { display: none;  }
.js #loader { display: block; position: absolute; left: 100px; top: 0; }
.se-pre-con {
  position: fixed;
  left: 0px;
  top: 0px;
  width: 100%;
  height: 100%;
  z-index: 9999;
  background: url(Preloader_3.gif) center no-repeat #fff;
}
 
   .content {
      background: url(map.hmtl
) center no-repeat;
      background-size: 100%;
      width: 100%;
    }
</style>
<script>
  //paste this code under head tag or in a seperate js file.
  // Wait for window load
  $(window).load(function() {
    // Animate loader off screen
    $(".se-pre-con").fadeOut("slow");;
  });
</script>

 <title>Casa Domus</title>
  <div style="font-family: 'Quicksand', sans-serif;" letter-spacing: 5px >
    <font size="6.5" color="black">
      We found a few places.  These are the top matches!
    </font>
  </div>


</header>

<body>
  <div class="se-pre-con"></div>

  <div class="content">

  <!- Angularjs View ->
  <div style="float: left" ng-app="mainApp" ng-controller="surveyController">

    <!- Input ->
    <div style="font-family: 'Quicksand', sans-serif;" letter-spacing: 5px >
    <div class="container-fluid">
    <div class="row">
    <div class="col order-2">
      <div id="mapDiv"></div> 
    </div>

    <div class="col order-1">
      <!-- top 5 suggestions -->
      <div class="row">
        <div class="col">County</div>
        <div class="col">Median Income</div>
        <div class="col">Median Property Value</div>
        <div class="col">Cost of Living Index</div>
        <div class="col">Medium Monthly Rent for 1 Bed Unit</div>
      </div>
      <br>

      <div class="row">
        <div class="col">
      <div class="row">
        <div class="col">{{resultList[0].areaName}}</div>
        <div class="col">${{resultList[0].medianHHIncome}}</div>
        <div class="col">${{resultList[0].medianProperty}}</div>
        <div class="col">{{resultList[0].costOfLiving}}</div>
        <div class="col">${{resultList[0].rent1Bed}}</div>
      </div>
      <br>

      <div class="row">
        <div class="col">{{resultList[1].areaName}}</div>
        <div class="col">${{resultList[1].medianHHIncome}}</div>
        <div class="col">${{resultList[1].medianProperty}}</div>
        <div class="col">{{resultList[1].costOfLiving}}</div>
        <div class="col">${{resultList[1].rent1Bed}}</div>
      </div>
      <br>

      <div class="row">
        <div class="col">{{resultList[2].areaName}}</div>
        <div class="col">${{resultList[2].medianHHIncome}}</div>
        <div class="col">${{resultList[2].medianProperty}}</div>
        <div class="col">{{resultList[2].costOfLiving}}</div>
        <div class="col">${{resultList[2].rent1Bed}}</div>
      </div>
      <br>

      <div class="row">
        <div class="col" >{{resultList[3].areaName}}</div>
        <div class="col">${{resultList[3].medianHHIncome}}</div>
        <div class="col">${{resultList[3].medianProperty}}</div>
        <div class="col">{{resultList[3].costOfLiving}}</div>
        <div class="col">${{resultList[3].rent1Bed}}</div>
      </div>
      <br>

      <div class="row">
        <div class="col" >{{resultList[4].areaName}}</div>
        <div class="col">${{resultList[4].medianHHIncome}}</div>
        <div class="col">${{resultList[4].medianProperty}}</div>
        <div class="col">{{resultList[4].costOfLiving}}</div>
        <div class="col">${{resultList[4].rent1Bed}}</div>
      </div>
      <br>

      <div class="row">
        <div class="col">What is your current median household income?</div>
        <div class="col"><input type="range" min="20000" max="200000" value="110000" class="slider" ng-model="userIncome">{{userIncome | currency}}</div>
      </div>

      <div class="row">
        <div class="col">How much property value can you afford?</div>
        <div class="col"><input type="range" min="19800" max="1000000" value="509900" class="slider" ng-model="userProperty">{{userProperty | currency}}</div>
      </div>

      <div class="row">
        <div class="col">How far do you want you dollar to go? (Cost of living index)</div>
        <div class="col"><input type="range" min="88" max="188" value="136.5" class="slider" ng-model="userLiving">{{userLiving}}</div>
      </div>

      <div class="row">
        <div class="col">How much can you afford to spend on rent a month?</div>
        <div class="col"><input type="range" min="400" max="3000" value="1700" class="slider" ng-model="userRent">{{userRent | currency}}</div>
      </div>

      <div class="row">
        <div class="col">How hot do you want it to be in the summer?</div>
        <div class="col"><input type="range" min="100" max="1700" value="1000" class="slider" ng-model="userJuly">{{userJuly}}&deg</div>
      </div>

      <div class="row">
        <div class="col">How cold do you want it be in the winter?</div>
        <div class="col"><input type="range" min="100" max="1700" value="1000" class="slider" ng-model="userJan">{{userJan}}&deg</div>
      </div>

      <div class="row">
        <div class="col"></div>
        <div class="col">
        <button ng-click = "openMap()" class="btn btn-primary btn-lg">Update results</button>
      </div>

    </div><!-- end of left col div -->

    

  </div> <!-- end of row div -->
    </div><!--end of container div -->
  </div> <!-- end of font style div -->
  </div><!-- end of angular div -->

  </div><!-- end of content div -->

  <script>
    //ACTUAL CODE STARTS EXECUTING HERE

    // Function: Extracts data parameters from url
    // from https://stackoverflow.com/questions/814613/how-to-read-get-data-from-a-url-using-javascript
    function parseURLParams(url) {
      var queryStart = url.indexOf("?") + 1,
        queryEnd = url.indexOf("#") + 1 || url.length + 1,
        query = url.slice(queryStart, queryEnd - 1),
        pairs = query.replace(/\+/g, " ").split("&"),
        parms = {}, i, n, v, nv;

      if (query === url || query === "") return;

      for (i = 0; i < pairs.length; i++) {
        nv = pairs[i].split("=", 2);
        n = decodeURIComponent(nv[0]);
        v = decodeURIComponent(nv[1]);

        if (!parms.hasOwnProperty(n)) parms[n] = [];
        parms[n].push(nv.length === 2 ? v : null);
      }
      return parms;
    }

    // Makes all json county data available
    parseCountyData();


    // Angularjs Controller
    var mainApp = angular.module("mainApp", []);

    mainApp.controller('surveyController', function ($scope) {
      // String with Output
      $scope.resultList = "";

      $scope.map = initializeMap("mapDiv");
      $scope.userResults = [];

      // get results from survey in the url
      $scope.userAnswers = parseURLParams(location.search);

      // User values from survey
      $scope.userIncome = parseFloat($scope.userAnswers['income']);
      $scope.userProperty = parseFloat($scope.userAnswers['property']);
      $scope.userLiving = parseFloat($scope.userAnswers['living']);
      $scope.userRent = parseFloat($scope.userAnswers['rent']);

      $scope.execute = function () {
        // call get results HERE
        $scope.userResults = calculateDistance($scope.userIncome, $scope.userProperty, $scope.userLiving, $scope.userRent);
        console.log("LOOK AT THIS ONE");
        console.log($scope.userResults);
        setGradientColors($scope.map, $scope.userResults);
        applyGradient($scope.map);
        this.getTopTen();
      }

      // the most barbaric way to print the results
      $scope.getTopTen = function () {
        $scope.resultList = [];
        $scope.resultList.push($scope.userResults[0]);
        $scope.resultList.push($scope.userResults[1]);
        $scope.resultList.push($scope.userResults[2]);
        $scope.resultList.push($scope.userResults[3]);
        $scope.resultList.push($scope.userResults[4]);
        // $scope.resultList.push($scope.userResults[5].areaName);
        // $scope.resultList.push($scope.userResults[6].areaName);
        // $scope.resultList.push($scope.userResults[7].areaName);
        // $scope.resultList.push($scope.userResults[8].areaName);
        // $scope.resultList.push($scope.userResults[9].areaName);

        console.log($scope.resultList);
      }

      $scope.openMap = function () {
        // go to maps page, bring the results of the questionnaire
        map_url = "map.html?income="
          + String($scope.userIncome) + "&property="
          + String($scope.userProperty) + "&living="
          + String($scope.userLiving) + "&rent="
          + String($scope.userRent);

        history.replaceState('data to be passed', 'Title of the page', map_url);
        this.execute();
      };

      // runs as soon as the page loads
      $scope.execute();
      setTimeout(function () {
        setGradientColors($scope.map, $scope.userResults);
        applyGradient($scope.map);
      }, 1000)
    });

  </script>
</body>
</html>
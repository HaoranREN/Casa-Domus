<html>

<head>
  <title>JavaScript Data Request</title>

</head>

<body>
  <h2>Javascript File IO with Papa Parse</h2>

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  <script src="http://127.0.0.1/~MarbleCake/papaparse.js" type="text/javascript"></script>
  <script src="http://127.0.0.1/~MarbleCake/data.js" type="text/javascript"></script>
  <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

  <div ng-app="mainApp" ng-controller="incomeController">

    <!- Input ->
    Enter a number of a county:
    <input type="number" ng-model="countyNum">
    <button ng-click="update()">Submit</button>

    <!- Outputs ->
    <table border="0">

      <tr>
        <td>State: </td>
        <td>{{state}}</td>
      </tr>

      <tr>
        <td>Area Name: </td>
        <td>{{areaName}}</td>
      </tr>

      <tr>
        <td>Median Household Income: </td>
        <td>{{medianHHIncome}}</td>
      </tr>

      <tr>
        <td>Median Property Value: </td>
        <td>{{medianProperty}}</td>
      </tr>

      <tr>
        <td>Cost of Living Index for {{state}}: </td>
        <td>{{costOfLiving}}</td>
      </tr>

      <tr>
        <td>Cost of Groceries Index for {{state}}: </td>
        <td>{{costOfGroceries}}</td>
      </tr>

    </table>
  </div>

  <!- Controller ->
  <script>
    var incomeJSON;
    var propertyJSON;
    var livingJSON;

    // Papa Parse Median Income Data
    Papa.parse(incomeData,
      {
        header: true,
        dynmicTyping: true,
        complete: function (results) {
          incomeJSON = JSON.parse(JSON.stringify(results.data));
          console.log(incomeJSON)
        }
      });

    // Papa Parse Median Property Value
    Papa.parse(propertyData,
      {
        header: true,
        dynamicTyping: true,
        complete: function (results) {
          propertyJSON = JSON.parse(JSON.stringify(results.data))
          console.log(propertyJSON)
        }
      });

    // Papa Parse Cost of Living Value
    Papa.parse(livingData,
      {
        header: true,
        dynamicTyping: true,
        complete: function (results) {
          livingJSON = JSON.parse(JSON.stringify(results.data))
          console.log(livingJSON)
        }
      });

    // Controller
    var mainApp = angular.module("mainApp", []);

    mainApp.controller('incomeController', function ($scope) {
      // Default Values (county 0 is Autauga County, AL)
      $scope.countyNum = 0;
      $scope.state = "AL";
      $scope.areaName = "Autauga County, AL";
      $scope.medianHHIncome = "54487";
      $scope.medianProperty = "141000";
      $scope.costOfLiving = "90.3";
      $scope.costOfGroceries = "97.4"

      // Updates the values on the view
      $scope.update = function () {
        $scope.state = incomeJSON[$scope.countyNum].State;
        $scope.areaName = incomeJSON[$scope.countyNum].Area_name;
        $scope.medianHHIncome = incomeJSON[$scope.countyNum].Median_Household_Income_2016;
        $scope.medianProperty = propertyJSON[$scope.countyNum].Median_Property_Value_2016;

        // Loop through states in living JSON until current state is found
        for (var key in livingJSON) {
          if (livingJSON[key].State === $scope.state) {
            $scope.costOfLiving = livingJSON[key].Index;
            $scope.costOfGroceries = livingJSON[key].Grocery;
          }
        }

      }
    });
  </script>

</body>

</html>